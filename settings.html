<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings & Configuration - MERC-CMMS Enterprise</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="mobile-responsive.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * {
            font-family: 'Inter', sans-serif;
        }
        .medical-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #2563eb 50%, #0891b2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .settings-header-bg {
            background-image: linear-gradient(135deg, #1e293b 0%, #2563eb 50%, #0891b2 100%);
        }
        .tab-button {
            padding: 12px 20px;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background: #eff6ff;
        }
        .tab-button:hover {
            background: #f8fafc;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .btn-primary {
            background: #2563eb;
            color: white;
        }
        .btn-primary:hover {
            background: #1d4ed8;
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }
        .btn-secondary:hover {
            background: #cbd5e1;
        }
        .btn-sm {
            padding: 8px 12px;
            font-size: 12px;
        }
        .toggle {
            position: relative;
            width: 48px;
            height: 26px;
            background: #cbd5e1;
            border-radius: 999px;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            padding: 0;
        }
        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .toggle.active {
            background: #2563eb;
        }
        .toggle.active::after {
            transform: translateX(22px);
        }
        .settings-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .settings-group {
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .settings-group:last-child {
            margin-bottom: 0;
        }
        .settings-label {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .settings-description {
            font-size: 13px;
            color: #64748b;
            margin-top: 6px;
        }
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }
        .toggle-row:not(:last-child) {
            border-bottom: 1px solid #e2e8f0;
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        .status-inactive {
            background: #f1f5f9;
            color: #64748b;
        }
        .badge-pulse {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        #mobile-menu {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            z-index: 40;
            background: linear-gradient(135deg, #1e293b 0%, #2563eb 50%, #0891b2 100%);
            padding: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(0);
            visibility: visible;
            opacity: 1;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        #mobile-menu.hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 700px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: white;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .toast.success {
            border-left: 4px solid #22c55e;
        }
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        .toast.info {
            border-left: 4px solid #3b82f6;
        }
        .hierarchy-tree-item {
            transition: background-color 0.2s;
        }
        .hierarchy-tree-item:hover {
            background-color: #f8fafc;
        }
        .hierarchy-indent {
            margin-left: 2rem;
        }
        .hierarchy-indent-2 {
            margin-left: 4rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <!-- Header -->
    <nav class="fixed top-0 left-0 right-0 z-50 medical-gradient shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-nowrap justify-between items-center gap-3 py-2 min-h-[4rem]">
                <a href="index.html" class="flex items-center space-x-4 min-w-0">
                    <img src="/resources/Logo_without%20name.png" alt="MERC-CMMS logo" class="w-10 h-10 rounded-full bg-white object-contain p-1">
                    <div class="min-w-0">
                        <h1 class="text-white text-xl font-bold truncate">MERC-CMMS</h1>
                        <p class="text-blue-200 text-xs truncate">Enterprise Medical Device Management</p>
                    </div>
                </a>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Dashboard</a>
                    <a href="customers.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Customers</a>
                    <a href="assets.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Assets</a>
                    <a href="work-orders.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Work Orders</a>
                    <a href="inventory.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Inventory</a>
                    <a href="compliance.html" class="text-blue-200 hover:text-white transition-colors whitespace-nowrap">Compliance</a>
                    <a href="settings.html" class="text-white font-semibold border-b-2 border-blue-300 pb-1 whitespace-nowrap">Settings</a>
                </div>
                <div class="flex items-center gap-3 flex-shrink-0">
                    <button id="mobile-menu-button" class="md:hidden text-white hover:text-blue-200 transition-colors" aria-label="Open menu" aria-expanded="false">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex items-center gap-3">
                        <button id="logout-button" class="text-white hover:text-blue-200 transition-colors" aria-label="Sign out">
                            <i class="fas fa-right-from-bracket text-xl"></i>
                        </button>
                    </div>
                    <div class="flex items-center space-x-2 min-w-0">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                        <div class="hidden md:block min-w-0">
                            <p class="text-white text-sm font-medium truncate">System Admin</p>
                            <p class="text-blue-200 text-xs truncate">Super Administrator</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden hidden medical-gradient shadow-lg">
        <div class="px-4 py-4 space-y-2">
            <a href="index.html" class="block text-blue-200 hover:text-white transition-colors">Dashboard</a>
            <a href="customers.html" class="block text-blue-200 hover:text-white transition-colors">Customers</a>
            <a href="assets.html" class="block text-blue-200 hover:text-white transition-colors">Assets</a>
            <a href="work-orders.html" class="block text-blue-200 hover:text-white transition-colors">Work Orders</a>
            <a href="inventory.html" class="block text-blue-200 hover:text-white transition-colors">Inventory</a>
            <a href="compliance.html" class="block text-blue-200 hover:text-white transition-colors">Compliance</a>
            <a href="settings.html" class="block text-white font-semibold">Settings</a>
        </div>
    </div>

    <!-- Main Content -->
    <main class="pt-16">
        <!-- Page Header -->
        <section class="bg-gradient-to-r from-blue-600 to-blue-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <h1 class="text-2xl font-bold text-white">Settings & Configuration</h1>
            </div>
        </section>

        <!-- Settings Navigation and Content -->
        <section class="py-8 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <!-- Tab Navigation -->
                <div class="bg-white rounded-t-lg shadow-md border-b border-slate-200">
                    <div class="flex flex-wrap gap-1 px-6 pt-6 overflow-x-auto">
                        <button class="tab-button active" data-tab="technicians" onclick="switchTab('technicians')">
                            <i class="fas fa-users"></i>Technicians
                        </button>
                        <button class="tab-button" data-tab="work-order-types" onclick="switchTab('work-order-types')">
                            <i class="fas fa-clipboard-list"></i>Work Order Types
                        </button>
                        <button class="tab-button" data-tab="checklists" onclick="switchTab('checklists')">
                            <i class="fas fa-tasks"></i>Checklists
                        </button>
                        <button class="tab-button" data-tab="master-database" onclick="switchTab('master-database')">
                            <i class="fas fa-database"></i>Master Database
                        </button>
                        <button class="tab-button" data-tab="system" onclick="switchTab('system')">
                            <i class="fas fa-sliders-h"></i>System
                        </button>
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="bg-white rounded-b-lg shadow-md">
                    <!-- Technicians Tab -->
                    <div id="technicians" class="tab-content active p-8">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">Technician Directory</h2>
                        
                        <div class="settings-section">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-users text-blue-600"></i>Technician Directory
                            </h3>
                            <p class="text-sm text-slate-600 mb-4">Add technicians to assign work orders across the system.</p>
                            <form id="technician-form" class="space-y-4 bg-slate-50 rounded-lg p-4 border border-slate-200">
                                <div>
                                    <label class="text-sm font-medium text-slate-700">Full Name</label>
                                    <input class="form-input mt-2" type="text" name="full_name" required placeholder="e.g., Avery Clark">
                                    </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-sm font-medium text-slate-700">Role</label>
                                        <select class="form-input mt-2" name="role">
                                            <option value="technician">Technician</option>
                                            <option value="supervisor">Supervisor</option>
                                            <option value="manager">Manager</option>
                                            <option value="contractor">Contractor</option>
                                        </select>
                                </div>
                                    <div>
                                        <label class="text-sm font-medium text-slate-700">Phone</label>
                                        <input class="form-input mt-2" type="text" name="phone" placeholder="(555) 555-5555">
                                    </div>
                                </div>
                                <div>
                                    <label class="text-sm font-medium text-slate-700">Email</label>
                                    <input class="form-input mt-2" type="email" name="email" placeholder="tech@example.com">
                                    </div>
                                <div class="flex items-center justify-between bg-white rounded-lg p-3 border border-slate-200">
                                    <span class="text-sm text-slate-600">Active Technician</span>
                                    <input type="checkbox" name="is_active" class="rounded border-slate-300" checked>
                                </div>
                                <button class="btn btn-primary" type="submit"><i class="fas fa-user-plus"></i>Add Technician</button>
                            </form>
                            <div class="mt-6">
                                <h4 class="text-sm font-semibold text-slate-700 mb-2">Active Technicians</h4>
                                <ul id="technician-list" class="space-y-2 text-sm text-slate-600">
                                    <li>Loading technicians...</li>
                                </ul>
                                    </div>
                                </div>
                            </div>

                    <!-- Checklists Tab -->
                    <div id="checklists" class="tab-content p-8" style="display: none;">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-slate-800">Checklists</h2>
                            <button onclick="ChecklistManager.showCreateModal()" class="btn btn-primary">
                                <i class="fas fa-plus"></i>Create Checklist
                            </button>
                        </div>

                        <div class="settings-section">
                            <div class="mb-4">
                                <p class="text-sm text-slate-600">Create reusable checklists that can be attached to work orders for PMs or regular maintenance tasks.</p>
                            </div>

                            <!-- Checklists Table -->
                            <div class="bg-white rounded-lg shadow overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Name</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Category</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Items</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
                                            <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checklists-table-body" class="bg-white divide-y divide-slate-200">
                                        <tr>
                                            <td colspan="5" class="px-6 py-8 text-center text-slate-500">
                                                <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                                <p>Loading checklists...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Master Database Setup Tab -->
                    <div id="master-database" class="tab-content p-8" style="display: none;">
                        <div class="flex items-center justify-between mb-6">
                                <div>
                                <h2 class="text-2xl font-bold text-slate-800">Master Database Setup</h2>
                                <p class="text-sm text-slate-600 mt-1">Manage the complete device catalog hierarchy: Type → Make → Model, plus PM Frequencies</p>
                                </div>
                            <button onclick="MasterDBManager.openMasterModal()" class="btn btn-primary">
                                <i class="fas fa-database"></i>Manage Master Database
                            </button>
                        </div>

                        <!-- Quick Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="settings-section text-center">
                                <div class="text-3xl font-bold text-blue-600" id="stats-categories">-</div>
                                <div class="text-sm text-slate-600 mt-1">Device Types</div>
                            </div>
                            <div class="settings-section text-center">
                                <div class="text-3xl font-bold text-green-600" id="stats-makes">-</div>
                                <div class="text-sm text-slate-600 mt-1">Manufacturers</div>
                            </div>
                            <div class="settings-section text-center">
                                <div class="text-3xl font-bold text-purple-600" id="stats-models">-</div>
                                <div class="text-sm text-slate-600 mt-1">Models</div>
                            </div>
                            <div class="settings-section text-center">
                                <div class="text-3xl font-bold text-orange-600" id="stats-frequencies">-</div>
                                <div class="text-sm text-slate-600 mt-1">PM Frequencies</div>
                            </div>
                        </div>

                        <!-- Info Card -->
                        <div class="settings-section bg-blue-50 border-blue-200">
                            <div class="flex items-start gap-3">
                                <i class="fas fa-info-circle text-blue-600 text-xl mt-1"></i>
                                <div>
                                    <h3 class="font-semibold text-slate-800 mb-2">Hierarchical Structure</h3>
                                    <p class="text-sm text-slate-600 mb-2">
                                        The Master Database follows a hierarchical structure where each level depends on the previous:
                                    </p>
                                    <ul class="text-sm text-slate-600 list-disc list-inside space-y-1">
                                        <li><strong>Device Types</strong> are the top-level categories (e.g., Diagnostic, Therapeutic)</li>
                                        <li><strong>Manufacturers</strong> belong to a Device Type (e.g., Philips under Diagnostic)</li>
                                        <li><strong>Models</strong> belong to a Manufacturer (e.g., HeartStart FR3 under Philips)</li>
                                        <li><strong>PM Frequencies</strong> are independent and can be used with any model</li>
                                    </ul>
                                    <button onclick="MasterDBManager.openMasterModal()" class="btn btn-primary btn-sm mt-3">
                                        <i class="fas fa-external-link-alt"></i>Open Master Database Manager
                                    </button>
                                </div>
                                </div>
                            </div>
                        </div>

                    <!-- System Tab -->
                    <div id="system" class="tab-content p-8" style="display: none;">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">System Configuration</h2>

                        <div class="settings-section">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">System Preferences</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Default Timezone</label>
                                    <select id="system-timezone" class="form-input">
                                        <option value="UTC">UTC</option>
                                        <option value="America/New_York" selected>America/New_York (EST/EDT)</option>
                                        <option value="America/Chicago">America/Chicago (CST/CDT)</option>
                                        <option value="America/Denver">America/Denver (MST/MDT)</option>
                                        <option value="America/Los_Angeles">America/Los_Angeles (PST/PDT)</option>
                                    </select>
                                    <p class="settings-description">Timezone for all date/time displays</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Maintenance Fiscal Year Start</label>
                                    <select id="system-fiscal-year" class="form-input">
                                        <option value="January" selected>January</option>
                                        <option value="April">April</option>
                                        <option value="July">July</option>
                                        <option value="October">October</option>
                                    </select>
                                    <p class="settings-description">Start month for fiscal year reporting</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3 class="text-lg font-semibold text-slate-800 mb-4">Data Management</h3>
                            <div class="space-y-4">
                                <div class="toggle-row">
                                    <div class="flex-1">
                                        <div class="settings-label">Enable data export</div>
                                        <div class="settings-description">Allow exporting data to CSV/Excel formats</div>
                                        </div>
                                        <button class="toggle active" role="switch" aria-checked="true" onclick="toggleSetting(this)"></button>
                                    </div>
                                <div class="toggle-row">
                                    <div class="flex-1">
                                        <div class="settings-label">Enable audit logging</div>
                                        <div class="settings-description">Track all system changes for compliance</div>
                                        </div>
                                        <button class="toggle active" role="switch" aria-checked="true" onclick="toggleSetting(this)"></button>
                                </div>
                            </div>
                                    </div>

                        <div class="settings-section">
                                        <div class="flex items-center justify-between mb-4">
                                            <div>
                                    <h3 class="text-lg font-semibold text-slate-800">Depreciation Profiles</h3>
                                    <p class="text-sm text-slate-600 mt-1">Manage reusable depreciation calculation profiles. Assets inherit from profiles automatically.</p>
                                            </div>
                                        </div>
                            
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start gap-3">
                                    <i class="fas fa-info-circle text-blue-600 text-xl mt-1"></i>
                                                <div>
                                        <h4 class="font-semibold text-blue-900 mb-2">Excel-Style Management</h4>
                                        <p class="text-sm text-blue-800 mb-2">
                                            Click any cell to edit inline. Use Tab/Enter to navigate. Paste CSV/tab-delimited data to bulk add rows.
                                        </p>
                                        <ul class="text-xs text-blue-700 list-disc list-inside space-y-1">
                                            <li>Click cell to edit • Tab/Enter to save • Escape to cancel</li>
                                            <li>Ctrl+V to paste multiple rows from Excel/CSV</li>
                                            <li>Only admins can add/edit/archive</li>
                                            <li>Changes automatically update all linked assets</li>
                                        </ul>
                                                </div>
                                                </div>
                                                </div>
                            
                            <div class="bg-white rounded-lg border border-slate-200 overflow-auto max-h-[60vh]">
                                <div id="depreciation-profiles-grid" class="p-4">
                                    <div class="text-center text-slate-500 py-8">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>Loading depreciation profiles...</p>
                                            </div>
                                            </div>
                                                </div>
                                            </div>
                                                </div>

                        <div class="flex justify-end gap-3 mt-6">
                            <button class="btn btn-secondary" onclick="showToast('Changes discarded', 'info')">Discard Changes</button>
                            <button class="btn btn-primary" onclick="SettingsManager.saveSystemSettings()">Save Settings</button>
                                        </div>
                                    </div>

                    <!-- Work Order Types Tab -->
                    <div id="work-order-types" class="tab-content p-8" style="display: none;">
                        <h2 class="text-2xl font-bold text-slate-800 mb-6">Work Order Types</h2>

                        <div class="settings-section">
                            <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                                            <div>
                                    <h3 class="text-lg font-semibold text-slate-800">Type Catalog</h3>
                                    <p class="text-sm text-slate-500">Manage the list of work order types used across the system.</p>
                                            </div>
                                        </div>

                            <form id="work-order-type-form" class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50 rounded-lg p-4 border border-slate-200">
                                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Type Code</label>
                                    <input id="work-order-type-code" class="form-input" type="text" placeholder="e.g., preventive_maintenance" required>
                                    <p class="settings-description">Used by the system to store the type in the database.</p>
                                                </div>
                                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Display Label</label>
                                    <input id="work-order-type-label" class="form-input" type="text" placeholder="Preventive Maintenance" required>
                                    <p class="settings-description">What users see on the work order form.</p>
                                                </div>
                                                <div>
                                    <label class="block text-sm font-semibold text-slate-700 mb-2">Description</label>
                                    <input id="work-order-type-description" class="form-input" type="text" placeholder="Scheduled maintenance tasks">
                                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-semibold text-slate-700 mb-2">Sort Order</label>
                                        <input id="work-order-type-sort" class="form-input" type="number" value="0" min="0">
                                            </div>
                                    <div class="flex items-center justify-between bg-white rounded-lg border border-slate-200 px-4 py-2 mt-6">
                                        <span class="text-sm text-slate-600">Active</span>
                                        <input id="work-order-type-active" type="checkbox" class="rounded border-slate-300" checked>
                                            </div>
                                                </div>
                                <div class="flex items-center gap-3 md:col-span-2">
                                    <button id="work-order-type-submit" class="btn btn-primary" type="submit">
                                        <i class="fas fa-plus"></i>Add Type
                                    </button>
                                    <button id="work-order-type-cancel" class="btn btn-secondary" type="button">Cancel Edit</button>
                                            </div>
                            </form>

                            <div class="mt-6 overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead>
                                        <tr class="border-b border-slate-200 text-xs uppercase text-slate-500">
                                            <th class="py-3 px-4">Label</th>
                                            <th class="py-3 px-4">Code</th>
                                            <th class="py-3 px-4">Description</th>
                                            <th class="py-3 px-4">Status</th>
                                            <th class="py-3 px-4">Sort</th>
                                            <th class="py-3 px-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="work-order-types-table">
                                        <tr>
                                            <td class="py-3 px-4 text-sm text-slate-500" colspan="6">Loading work order types...</td>
                                        </tr>
                                    </tbody>
                                </table>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
        </section>
    </main>

    <footer class="bg-slate-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-slate-400">&copy; 2025 MERC-CMMS Enterprise. All rights reserved.</p>
                                        </div>
    </footer>

    <div id="toast-container" class="fixed bottom-4 right-4 z-50"></div>

    <!-- Master Database Unified Modal -->
    <div id="master-db-modal" class="modal">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh;">
            <div class="flex justify-between items-center mb-6">
                                        <div>
                    <h3 class="text-2xl font-bold text-slate-800">Master Database Manager</h3>
                    <p class="text-sm text-slate-600 mt-1">Manage Type → Make → Model hierarchy and PM Frequencies</p>
                                        </div>
                <button onclick="MasterDBManager.closeModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
                                    </div>

            <!-- Tabs for different sections -->
            <div class="flex gap-2 mb-6 border-b border-slate-200">
                <button id="master-db-tab-unified" onclick="MasterDBManager.switchMasterTab('unified')" class="px-4 py-2 font-semibold text-blue-600 border-b-2 border-blue-600">
                    <i class="fas fa-table"></i> Type → Make → Model
                </button>
                <button id="master-db-tab-configurations" onclick="MasterDBManager.switchMasterTab('configurations')" class="px-4 py-2 font-semibold text-slate-500 hover:text-slate-700">
                    <i class="fas fa-cogs"></i> Device Configurations
                </button>
                <button id="master-db-tab-frequencies" onclick="MasterDBManager.switchMasterTab('frequencies')" class="px-4 py-2 font-semibold text-slate-500 hover:text-slate-700">
                    <i class="fas fa-calendar-alt"></i> PM Frequencies
                </button>
                                </div>

            <!-- Configurations Tab Content -->
            <div id="master-db-configurations-content" class="space-y-4">
                <!-- Search and Actions -->
                <div class="flex gap-3 mb-4">
                    <input type="text" id="config-search" placeholder="Search configurations..." class="form-input flex-1" onkeyup="MasterDBManager.filterConfigurations()">
                    <button onclick="MasterDBManager.openConfigModal()" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Configuration
                    </button>
                    <button onclick="MasterDBManager.showBulkUploadModal()" class="btn btn-secondary">
                        <i class="fas fa-upload"></i> Bulk Upload
                    </button>
                        </div>

                <!-- Configurations Table -->
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Configuration Name</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Type</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Make</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Model</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">PM Frequency</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Checklist</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Status</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="configurations-table" class="bg-white divide-y divide-slate-200">
                            <tr>
                                <td colspan="8" class="px-4 py-8 text-center text-slate-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading configurations...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                            </div>
                        </div>

            <!-- Unified MMD Grid Tab Content -->
            <div id="master-db-unified-content" class="space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-blue-600 text-xl mt-1"></i>
                                    <div>
                            <h4 class="font-semibold text-blue-900 mb-2">Excel-Style Unified View</h4>
                            <p class="text-sm text-blue-800 mb-2">
                                Single view showing Type → Make → Model hierarchy. Click any cell to edit inline. Use Tab/Enter to navigate.
                            </p>
                            <ul class="text-xs text-blue-700 list-disc list-inside space-y-1">
                                <li>Click cell to edit • Tab/Enter to save • Escape to cancel</li>
                                <li>Type column: Select from dropdown or type new name</li>
                                <li>Make column: Select from dropdown (filtered by Type) or type new name</li>
                                <li>Model column: Type model name (requires Make and PM Frequency)</li>
                                <li>PM Frequency: Select from dropdown (required for Models)</li>
                                <li>Click "Add New Row" to add at bottom</li>
                            </ul>
                                    </div>
                                </div>
                                    </div>
                <div class="bg-white rounded-lg border border-slate-200 overflow-auto max-h-[60vh]">
                    <div id="unified-mmd-grid" class="p-4">
                        <div class="text-center text-slate-500 py-8">
                            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                            <p>Loading MMD data...</p>
                                </div>
                                    </div>
                                </div>
                            </div>

            <!-- PM Frequencies Tab Content -->
            <div id="master-db-frequencies-content" class="space-y-4" style="display: none;">
                <div class="flex gap-3 mb-4">
                    <input type="text" id="frequency-search" placeholder="Search PM frequencies..." class="form-input flex-1" onkeyup="MasterDBManager.filterFrequencies()">
                    <button onclick="MasterDBManager.openAddModal('pm-frequency')" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Add Frequency
                            </button>
                        </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50">
                            <tr>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Name</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Code</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Days</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Description</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Status</th>
                                <th class="px-4 py-3 text-xs font-medium text-slate-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="master-db-frequencies-table" class="bg-white divide-y divide-slate-200">
                            <tr>
                                <td colspan="6" class="px-4 py-8 text-center text-slate-500">
                                    <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading PM frequencies...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                        </div>
                    </div>
                                    </div>
                                </div>

    <!-- Add/Edit Configuration Modal -->
    <div id="config-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-slate-800" id="config-modal-title">Add Device Configuration</h3>
                <button onclick="MasterDBManager.closeConfigModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
                                    </div>
            <form id="config-form" class="space-y-4">
                <input type="hidden" id="config-id">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Configuration Name <span class="text-red-500">*</span></label>
                    <input type="text" id="config-name" class="form-input" required placeholder="e.g., Zoll R Series Defib - Monthly PM">
                    <p class="text-xs text-slate-500 mt-1">A descriptive name for this configuration</p>
                                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Device Type <span class="text-red-500">*</span></label>
                        <div class="flex gap-2">
                            <select id="config-category" class="form-input flex-1" required onchange="MasterDBManager.updateConfigMakes()">
                                <option value="">Select Type</option>
                                    </select>
                            <button type="button" onclick="MasterDBManager.showQuickAddType()" class="btn btn-secondary btn-sm whitespace-nowrap" title="Add New Type">
                                <i class="fas fa-plus"></i>
                            </button>
                                    </div>
                        <div id="config-new-type-container" class="mt-2 hidden">
                            <input type="text" id="config-new-type-name" class="form-input mb-2" placeholder="New Type Name">
                            <textarea id="config-new-type-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)"></textarea>
                            <div class="flex gap-2">
                                <button type="button" onclick="MasterDBManager.createNewType()" class="btn btn-primary btn-sm">
                                    <i class="fas fa-check"></i> Create
                                </button>
                                <button type="button" onclick="MasterDBManager.cancelQuickAdd('type')" class="btn btn-secondary btn-sm">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                </div>
                            </div>
                        </div>
                                <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Manufacturer <span class="text-red-500">*</span></label>
                        <div class="flex gap-2">
                            <select id="config-make" class="form-input flex-1" required onchange="MasterDBManager.updateConfigModels()" disabled>
                                <option value="">Select Manufacturer</option>
                                    </select>
                            <button type="button" onclick="MasterDBManager.showQuickAddMake()" class="btn btn-secondary btn-sm whitespace-nowrap" title="Add New Manufacturer" id="config-add-make-btn" disabled>
                                <i class="fas fa-plus"></i>
                            </button>
                                    </div>
                        <div id="config-new-make-container" class="mt-2 hidden">
                            <input type="text" id="config-new-make-name" class="form-input mb-2" placeholder="New Manufacturer Name">
                            <textarea id="config-new-make-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)"></textarea>
                            <div class="flex gap-2">
                                <button type="button" onclick="MasterDBManager.createNewMake()" class="btn btn-primary btn-sm">
                                    <i class="fas fa-check"></i> Create
                                </button>
                                <button type="button" onclick="MasterDBManager.cancelQuickAdd('make')" class="btn btn-secondary btn-sm">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                </div>
                                    </div>
                                </div>
                            </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Model <span class="text-red-500">*</span></label>
                        <div class="flex gap-2">
                            <select id="config-model" class="form-input flex-1" required disabled>
                                <option value="">Select Model</option>
                            </select>
                            <button type="button" onclick="MasterDBManager.showQuickAddModel()" class="btn btn-secondary btn-sm whitespace-nowrap" title="Add New Model" id="config-add-model-btn" disabled>
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="config-new-model-container" class="mt-2 hidden">
                            <input type="text" id="config-new-model-name" class="form-input mb-2" placeholder="New Model Name">
                            <textarea id="config-new-model-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)"></textarea>
                            <div class="flex gap-2">
                                <button type="button" onclick="MasterDBManager.createNewModel()" class="btn btn-primary btn-sm">
                                    <i class="fas fa-check"></i> Create
                                </button>
                                <button type="button" onclick="MasterDBManager.cancelQuickAdd('model')" class="btn btn-secondary btn-sm">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                        </div>
                    </div>
                                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">PM Frequency</label>
                        <select id="config-pm-frequency" class="form-input">
                            <option value="">No PM Schedule</option>
                        </select>
                                </div>
                                    </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">PM Checklist</label>
                    <select id="config-checklist" class="form-input">
                        <option value="">No Checklist</option>
                    </select>
                                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                    <textarea id="config-description" rows="3" class="form-input" placeholder="Optional description"></textarea>
                            </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="config-active" checked class="rounded border-gray-300">
                    <label for="config-active" class="text-sm font-medium text-slate-700">Active</label>
                        </div>
                        <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="MasterDBManager.closeConfigModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Configuration</button>
                </div>
            </form>
                        </div>
                    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulk-upload-modal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-slate-800">Bulk Upload Configurations</h3>
                <button onclick="MasterDBManager.closeBulkUploadModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
                                </div>
            <div class="space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-900 mb-2">CSV Format</h4>
                    <p class="text-sm text-blue-800 mb-2">Upload a CSV file with the following columns:</p>
                    <code class="text-xs bg-white p-2 rounded block">Type, Make, Model, PM Frequency, Checklist (optional), Description (optional)</code>
                    <a href="#" onclick="MasterDBManager.downloadTemplate()" class="text-sm text-blue-600 hover:underline mt-2 inline-block">
                        <i class="fas fa-download"></i> Download CSV Template
                    </a>
                                    </div>
                                    <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Select CSV File</label>
                    <input type="file" id="bulk-upload-file" accept=".csv" class="form-input">
                                    </div>
                <div id="bulk-upload-preview" class="hidden">
                    <h4 class="font-semibold text-slate-800 mb-2">Preview (first 5 rows)</h4>
                    <div class="overflow-x-auto max-h-60 overflow-y-auto border border-slate-200 rounded">
                        <table class="w-full text-sm" id="bulk-preview-table"></table>
                                </div>
                                </div>
                        <div class="flex justify-end gap-3 mt-6">
                    <button type="button" onclick="MasterDBManager.closeBulkUploadModal()" class="btn btn-secondary">Cancel</button>
                    <button type="button" onclick="MasterDBManager.processBulkUpload()" class="btn btn-primary" id="bulk-upload-btn" disabled>
                        <i class="fas fa-upload"></i> Upload Configurations
                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- Add/Edit Item Modal (for individual items) -->
    <div id="master-db-item-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-slate-800" id="master-db-item-modal-title">Add Device Type</h3>
                <button onclick="MasterDBManager.closeItemModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
            <form id="master-db-form" class="space-y-4">
                <input type="hidden" id="master-db-id">
                <input type="hidden" id="master-db-type">
                
                <!-- Category Fields -->
                <div id="category-fields">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Name <span class="text-red-500">*</span></label>
                        <input type="text" id="category-name" class="form-input" required placeholder="e.g., Diagnostic">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                        <textarea id="category-description" class="form-input" rows="3" placeholder="Brief description"></textarea>
                    </div>
                            </div>

                <!-- Make Fields -->
                <div id="make-fields" style="display: none;">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Device Type <span class="text-red-500">*</span></label>
                        <select id="make-type-id" class="form-input" required>
                            <option value="">Select Device Type</option>
                        </select>
                            </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Manufacturer Name <span class="text-red-500">*</span></label>
                        <input type="text" id="make-name" class="form-input" required placeholder="e.g., Philips">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                        <textarea id="make-description" class="form-input" rows="3" placeholder="Brief description"></textarea>
                        </div>
                    </div>

                <!-- Model Fields -->
                <div id="model-fields" style="display: none;">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Device Type <span class="text-red-500">*</span></label>
                        <select id="model-type-id" class="form-input" required onchange="MasterDBManager.updateMakeDropdown()">
                            <option value="">Select Device Type</option>
                        </select>
                        </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Manufacturer <span class="text-red-500">*</span></label>
                        <select id="model-make-id" class="form-input" required>
                            <option value="">Select Manufacturer</option>
                        </select>
                    </div>
                                <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Model Name <span class="text-red-500">*</span></label>
                        <input type="text" id="model-name" class="form-input" required placeholder="e.g., HeartStart FR3">
                                </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">PM Frequency <span class="text-red-500">*</span></label>
                        <select id="model-pm-frequency-id" class="form-input" required>
                            <option value="">Select PM Frequency</option>
                        </select>
                        <p class="text-xs text-slate-500 mt-1">
                            <i class="fas fa-info-circle"></i> PM Frequency is REQUIRED at Model level. This is the source of truth for all assets using this model.
                        </p>
                            </div>
                                <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                        <textarea id="model-description" class="form-input" rows="3" placeholder="Brief description"></textarea>
                                </div>
                </div>

                <!-- PM Frequency Fields -->
                <div id="pm-frequency-fields" style="display: none;">
                                <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Name <span class="text-red-500">*</span></label>
                        <input type="text" id="pm-frequency-name" class="form-input" required placeholder="e.g., Monthly">
                                </div>
                                <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Code <span class="text-red-500">*</span></label>
                        <input type="text" id="pm-frequency-code" class="form-input" required placeholder="e.g., monthly">
                        <p class="text-xs text-slate-500 mt-1">Used internally by the system (lowercase, no spaces)</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Days <span class="text-red-500">*</span></label>
                            <input type="number" id="pm-frequency-days" class="form-input" required min="1" placeholder="30">
                                    </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Sort Order</label>
                            <input type="number" id="pm-frequency-sort" class="form-input" min="0" value="0">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Description</label>
                        <textarea id="pm-frequency-description" class="form-input" rows="2" placeholder="e.g., Every 30 days"></textarea>
                    </div>
                    <div class="flex items-center justify-between bg-white rounded-lg border border-slate-200 px-4 py-3">
                                        <span class="text-sm text-slate-600">Active</span>
                        <input type="checkbox" id="pm-frequency-active" class="rounded border-slate-300" checked>
                                    </div>
                                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t border-slate-200">
                    <button type="button" onclick="MasterDBManager.closeItemModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" id="master-db-save-btn" onclick="event.preventDefault(); MasterDBManager.handleSubmit(event);" class="btn btn-primary">Save</button>
                                </div>
                            </form>
        </div>
    </div>

    <!-- Quick Add Modal (Single Step: Type → Make → Model → PM Frequency) -->
    <div id="quick-add-modal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-slate-800">Quick Add: Type → Make → Model → PM Frequency</h3>
                <button onclick="MasterDBManager.closeQuickAddModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="quick-add-form" class="space-y-6">
                <div class="grid grid-cols-4 gap-4">
                    <!-- Type Column -->
                    <div class="space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-900 mb-3 flex items-center gap-2">
                                <i class="fas fa-tag text-blue-600"></i>
                                Device Type
                            </h4>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Select or Add New</label>
                                <select id="quick-type-select" class="form-input mb-2" onchange="MasterDBManager.handleQuickTypeChange()">
                                    <option value="">-- Select Existing --</option>
                                </select>
                                <div class="text-xs text-slate-500 mb-2">OR</div>
                                <input type="text" id="quick-type-name" class="form-input mb-2" placeholder="New Type Name" oninput="MasterDBManager.handleQuickTypeChange()">
                                <textarea id="quick-type-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Make Column -->
                    <div class="space-y-4">
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-900 mb-3 flex items-center gap-2">
                                <i class="fas fa-industry text-green-600"></i>
                                Manufacturer
                            </h4>
                                <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Select or Add New</label>
                                <select id="quick-make-select" class="form-input mb-2" disabled onchange="MasterDBManager.handleQuickMakeChange()">
                                    <option value="">-- Select Type First --</option>
                                    </select>
                                <div class="text-xs text-slate-500 mb-2">OR</div>
                                <input type="text" id="quick-make-name" class="form-input mb-2" placeholder="New Make Name" disabled oninput="MasterDBManager.handleQuickMakeChange()">
                                <textarea id="quick-make-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)" disabled></textarea>
                                </div>
                        </div>
                    </div>

                    <!-- Model Column -->
                    <div class="space-y-4">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-900 mb-3 flex items-center gap-2">
                                <i class="fas fa-cube text-purple-600"></i>
                                Model
                            </h4>
                                <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Select or Add New</label>
                                <select id="quick-model-select" class="form-input mb-2" disabled onchange="MasterDBManager.handleQuickModelChange()">
                                    <option value="">-- Select Make First --</option>
                                    </select>
                                <div class="text-xs text-slate-500 mb-2">OR</div>
                                <input type="text" id="quick-model-name" class="form-input mb-2" placeholder="New Model Name" disabled oninput="MasterDBManager.handleQuickModelChange()">
                                <textarea id="quick-model-desc" class="form-input text-sm" rows="2" placeholder="Description (optional)" disabled></textarea>
                                </div>
                            </div>
                        </div>

                    <!-- PM Frequency Column -->
                    <div class="space-y-4">
                        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                            <h4 class="font-semibold text-amber-900 mb-3 flex items-center gap-2">
                                <i class="fas fa-calendar-check text-amber-600"></i>
                                PM Frequency
                            </h4>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-2">Select Frequency</label>
                                <select id="quick-pm-frequency" class="form-input" disabled>
                                    <option value="">-- Select Model First --</option>
                                </select>
                                <p class="text-xs text-slate-500 mt-2">PM frequency will be linked to the model</p>
                        </div>
                    </div>
                </div>
            </div>

                <!-- Summary Preview -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-4">
                    <h4 class="font-semibold text-slate-800 mb-2">Preview</h4>
                    <div id="quick-add-preview" class="text-sm text-slate-600">
                        <p class="italic">Fill in the fields above to see preview</p>
        </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t border-slate-200">
                    <button type="button" onclick="MasterDBManager.closeQuickAddModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" onclick="event.preventDefault(); MasterDBManager.handleQuickAddSubmit(event);" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save All
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create/Edit Checklist Modal -->
    <div id="checklist-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-slate-800" id="checklist-modal-title">Create Checklist</h3>
                <button onclick="ChecklistManager.hideModal()" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="flex gap-2 mb-4 border-b border-slate-200">
                <button id="checklist-edit-tab" onclick="ChecklistManager.switchTab('edit')" class="px-4 py-2 font-semibold text-blue-600 border-b-2 border-blue-600">Edit</button>
                <button id="checklist-preview-tab" onclick="ChecklistManager.switchTab('preview')" class="px-4 py-2 font-semibold text-slate-500 hover:text-slate-700">Preview</button>
            </div>

            <!-- Preview Container (shown when preview tab is active) -->
            <div id="checklist-preview-container" class="space-y-5" style="display: none;">
                <div id="checklist-preview-content">
                    <!-- Preview content will be rendered here -->
                </div>
            </div>

            <form id="checklist-form" class="space-y-5">
                <input type="hidden" id="checklist-id">
                
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Name <span class="text-red-500">*</span></label>
                    <input type="text" id="checklist-name" required class="form-input" placeholder="e.g., Ventilator PM Checklist">
                    <p class="text-xs text-red-500 mt-1 hidden" id="checklist-name-error">The name is required</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Description</label>
                    <textarea id="checklist-description" rows="3" class="form-input" placeholder="Brief description of this checklist"></textarea>
                </div>

                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Category</label>
                    <select id="checklist-category" class="form-input">
                        <option value="">Select Category</option>
                        <option value="PM">Preventive Maintenance</option>
                        <option value="Inspection">Inspection</option>
                        <option value="Repair">Repair</option>
                        <option value="Calibration">Calibration</option>
                        <option value="General">General</option>
                    </select>
                </div>

                <!-- Checklist Items Section -->
                <div class="border-t border-slate-200 pt-5">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-slate-800">Checklist Items</h4>
                        <div class="flex gap-2">
                            <button type="button" onclick="ChecklistManager.addChecklistItem()" class="btn btn-secondary btn-sm">
                                <i class="fas fa-plus"></i>Task
                            </button>
                        </div>
                    </div>

                    <div id="checklist-items-container" class="space-y-3">
                        <!-- Checklist items will be added here dynamically -->
                    </div>
                </div>

                <div class="flex justify-end space-x-3 pt-4 border-t border-slate-200">
                    <button type="button" onclick="ChecklistManager.hideModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Checklist</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="main.js"></script>
    <script src="js/mmd-validation.js"></script>
    <script src="js/mmd-reference-manager.js"></script>
    <script src="js/excel-grid-manager.js"></script>
    <script src="js/unified-mmd-grid.js"></script>
    <script src="js/unified-mmd-modal.js"></script>
    <script src="js/depreciation-reference-manager.js"></script>
    <script src="js/depreciation-profiles-manager.js"></script>
    <script src="js/master-db-manager.js?v=2"></script>
    <script src="js/settings-manager.js"></script>
    <script>
        // Initialize unified MMD modal for Settings page
        let unifiedMMDModalInstance = null;
        function openUnifiedMMDModal(context = {}) {
            console.log('openUnifiedMMDModal called from Settings with context:', context);
            try {
                const supabaseClient = window.supabaseClient || window.sharedSupabaseClient;
                if (!supabaseClient) {
                    console.error('No Supabase client available');
                    alert('Database connection not available');
                    return;
                }

                if (!window.UnifiedMMDModal) {
                    console.error('UnifiedMMDModal class not loaded yet');
                    alert('MMD Modal system not loaded. Please refresh the page.');
                    return;
                }

                if (!unifiedMMDModalInstance) {
                    console.log('Creating new UnifiedMMDModal instance for Settings');
                    unifiedMMDModalInstance = new window.UnifiedMMDModal(supabaseClient);
                }

                console.log('Opening unified MMD modal from Settings');
                unifiedMMDModalInstance.open(context);
            } catch (error) {
                console.error('Error opening unified MMD modal:', error);
                alert(`Error: ${error.message}`);
            }
        }
        window.openUnifiedMMDModal = openUnifiedMMDModal;
    </script>
    <script>
        // Initialize Depreciation Profiles Manager on System tab
        async function initDepreciationProfiles() {
            const container = document.getElementById('depreciation-profiles-grid');
            if (!container) {
                console.error('Depreciation profiles container not found');
                return;
            }

            // Check if already initialized
            if (window.depreciationProfilesManager) {
                return;
            }

            // Wait for Supabase client
            let supabaseClient = window.sharedSupabaseClient;
            if (!supabaseClient) {
                // Wait a bit for it to initialize
                await new Promise(resolve => setTimeout(resolve, 500));
                supabaseClient = window.sharedSupabaseClient;
            }

            if (!supabaseClient) {
                console.error('Supabase client not available');
                container.innerHTML = '<div class="text-center text-red-600 py-8"><i class="fas fa-exclamation-triangle text-2xl mb-2"></i><p>Error: Supabase client not initialized</p></div>';
                return;
            }

            try {
                window.depreciationProfilesManager = new window.DepreciationProfilesManager(
                    'depreciation-profiles-grid',
                    supabaseClient
                );
                await window.depreciationProfilesManager.init();
            } catch (error) {
                console.error('Error initializing depreciation profiles:', error);
                container.innerHTML = `<div class="text-center text-red-600 py-8"><i class="fas fa-exclamation-triangle text-2xl mb-2"></i><p>Error loading: ${error.message}</p></div>`;
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize when System tab button is clicked
            const systemTabButton = document.querySelector('[data-tab="system"]');
            if (systemTabButton) {
                systemTabButton.addEventListener('click', async () => {
                    // Small delay to ensure tab is shown
                    setTimeout(async () => {
                        await initDepreciationProfiles();
                    }, 100);
                });
            }

            // Also initialize if System tab is already active on page load
            const systemContent = document.getElementById('system');
            if (systemContent && systemContent.style.display !== 'none') {
                await initDepreciationProfiles();
            }
        });
    </script>
    <script>
        // Initialize SettingsManager and MasterDBManager when DOM is ready
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize SettingsManager first
            if (typeof SettingsManager !== 'undefined') {
                await SettingsManager.init();
            }
            
            // Initialize MasterDBManager
            if (typeof MasterDBManager !== 'undefined') {
                MasterDBManager.init();
            }
        });
        
        // Tab switching function
        async function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            const selectedTab = document.getElementById(tabName);
            if (selectedTab) {
                selectedTab.classList.add('active');
                selectedTab.style.display = 'block';
            }
            
            // Add active class to selected tab button
            const selectedButton = document.querySelector(`[data-tab="${tabName}"]`);
            if (selectedButton) {
                selectedButton.classList.add('active');
            }

            // Initialize depreciation profiles when System tab is shown
            if (tabName === 'system') {
                await initDepreciationProfiles();
            }
        }

        // Toggle setting function
        function toggleSetting(element) {
            element.classList.toggle('active');
            element.setAttribute('aria-checked', element.classList.contains('active'));
        }

        // Show toast function (if not in main.js)
        if (typeof showToast === 'undefined') {
            function showToast(message, type = 'info', duration = 3000) {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                
                container.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
        }
        
        // Setup mobile menu using centralized function
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof setupMobileMenu === 'function') {
                setupMobileMenu();
            } else {
                // Fallback if setupMobileMenu not available
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');
                if (mobileMenuButton && mobileMenu) {
                    mobileMenuButton.addEventListener('click', () => {
                        mobileMenu.classList.toggle('hidden');
                        const isExpanded = !mobileMenu.classList.contains('hidden');
                        mobileMenuButton.setAttribute('aria-expanded', isExpanded);
                    });
                    // Close menu when clicking links
                    mobileMenu.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', () => {
                            if (!mobileMenu.classList.contains('hidden')) {
                                mobileMenu.classList.add('hidden');
                                mobileMenuButton.setAttribute('aria-expanded', 'false');
                            }
                        });
                    });
                }
            }
        });
    </script>
</body>
</html>
